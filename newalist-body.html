<!-- 2025-05-31 11:55:53 -->

<style>
    .hope-ui-light,
    .hope-ui-dark {
        --hope-colors-background: transparent;
    }
</style>

<script>
    const THEME_COLOR = 'rgb(240, 128, 128)';
    const LIGHT_BG_COLOR = 'rgba(255, 255, 255, 0.8)';
    const DARK_BG_COLOR = 'rgb(32, 36, 37)';

    const LIGHT_SELECTOR = '.hope-ui-light :not(.hope-tooltip):not(.hope-close-button):not(a)';
    const DARK_SELECTOR = '.hope-ui-dark :not(.hope-tooltip):not(.hope-close-button):not(a)';
    const IGNORED_COLORS = [
        'rgba(0, 0, 0, 0)',
        'rgba(0, 0, 0, 0.65)',
        'rgba(0, 0, 0, 0.09)',
        THEME_COLOR
    ];

    (function() {
        const wrapHistoryMethod = (type) => {
            const orig = history[type];
            return function(...args) {
                const rv = orig.apply(this, args);
                const event = new CustomEvent(type, { detail: args });
                window.dispatchEvent(event);
                return rv;
            };
        };
        history.pushState = wrapHistoryMethod('pushState');
        history.replaceState = wrapHistoryMethod('replaceState');
    })();

    const beautifier = new MutationObserver(() => {
        if (!location.pathname.startsWith('/@manage') && !location.pathname.startsWith('/@login')) {
            document.querySelectorAll(LIGHT_SELECTOR).forEach(element => {
                const computedStyle = getComputedStyle(element);

                if (computedStyle.backgroundImage !== 'none') {
                    return;
                }

                if (!IGNORED_COLORS.includes(computedStyle.backgroundColor)) {
                    element.style.backgroundColor = LIGHT_BG_COLOR;
                }
            });

            document.querySelectorAll(DARK_SELECTOR).forEach(element => {
                const computedStyle = getComputedStyle(element);

                if (computedStyle.backgroundImage !== 'none') {
                    return;
                }

                if (!IGNORED_COLORS.includes(computedStyle.backgroundColor)) {
                    element.style.backgroundColor = DARK_BG_COLOR;
                }
            });
        }
    });

    function observe() {
        beautifier.observe(document.body, {
            childList: true,
            subtree: true
        });
    }

    observe();

    function fixLogin() {
        document.querySelector('a[href="/@login"]')?.addEventListener('click', () => {
            beautifier.disconnect();
        });
    }

    window.addEventListener('replaceState', observe);
    window.addEventListener('pushState', observe);
    window.addEventListener('keydown', fixLogin);
    window.addEventListener('mousedown', fixLogin);
</script>